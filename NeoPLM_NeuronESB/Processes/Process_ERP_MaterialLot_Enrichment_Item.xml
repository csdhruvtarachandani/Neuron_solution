<?xml version="1.0"?>
<ESBMessagePipelineStorage xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <Id>c7a3d699-b87d-447b-9f52-68c841cba2da</Id>
  <Version>863b42dd-9b83-44b8-bc1c-8335a74b7ddf</Version>
  <BusinessFlows />
  <Description />
  <Name>Process_ERP_MaterialLot_Enrichment_Item</Name>
  <IsSystemObject>false</IsSystemObject>
  <IsPrivate>false</IsPrivate>
  <Category>General</Category>
  <IsEncrypted>true</IsEncrypted>
  <Path>Main Processes</Path>
  <PipelineBlob>&lt;ESBMessagePipeline xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.neuronesb.com/pipelines/"&gt;&lt;Category&gt;General&lt;/Category&gt;&lt;Description i:nil="true" /&gt;&lt;GlobalProperties xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Name&gt;Process_ERP_MaterialLot_Enrichment_Item&lt;/Name&gt;&lt;Properties xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;ReferencedAssemblies xmlns:d2p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" i:nil="true" /&gt;&lt;Steps&gt;&lt;ESBMessagePipelineStep i:type="ExceptionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d4p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;42a18705-a0e3-4ceb-9025-652feb8e39bd&lt;/Id&gt;&lt;Name&gt;Exception&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Catch&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d7ce8078-6eaf-45c1-aa62-e4e91d8b39c9&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;f47e106c-474a-4a05-aa5e-71f823ceac5f&lt;/Id&gt;&lt;Name&gt;Exception Handler&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:FileName i:nil="true" /&gt;&lt;d6p1:MaxInstances&gt;100&lt;/d6p1:MaxInstances&gt;&lt;d6p1:PipelineName&gt;Exception Handler&lt;/d6p1:PipelineName&gt;&lt;d6p1:PoolTimeout&gt;PT1M&lt;/d6p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Catch&gt;&lt;Finally&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;8e3f373d-647b-4391-8da7-c1a95a3a6906&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;f639b61f-606f-44f5-8096-1c8f5996eda1&lt;/Id&gt;&lt;Name&gt;Finally of Process_ERP_Goods_Issue_Enrichment_Item&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation("Finally called for Finally of Process_ERP_MaterialLot_Enrichment_Item process");
var localServiceUrl = Convert.ToString(context.Properties["LocalServiceURI"]);
if(!String.IsNullOrWhiteSpace(localServiceUrl))
{
	String prefix = "workflow";
	context.Data.SetProperty(prefix,  "LocalServiceURI", localServiceUrl);
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typebfbedcbe967467c9be740ebdbedfcf&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Finally&gt;&lt;Try&gt;&lt;Bindings xmlns:d5p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4cd5e9ee-8d5f-4320-8a3e-1af9619ea5db&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ad6ce07b-8b15-4d33-aedf-06a36273bb49&lt;/Id&gt;&lt;Name&gt;ReadCommonWorkflowProp&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d6p1:FileName i:nil="true" /&gt;&lt;d6p1:MaxInstances&gt;100&lt;/d6p1:MaxInstances&gt;&lt;d6p1:PipelineName&gt;FUNC_ReadCommonWorkflowProp&lt;/d6p1:PipelineName&gt;&lt;d6p1:PoolTimeout&gt;PT1M&lt;/d6p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;61697781-3385-4768-b25a-ecd43cce6c61&lt;/Id&gt;&lt;Name&gt;Define Global Variables&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;//Save original message in case we need it later
//context.Properties.Add ("OrigMsg", context.Data.Clone(true));

//Init and load transaction values
//context.Properties.Add ("ProcessTitle", "ERP Material Lot Enrichment");
context.Properties.Add ("OriginalMessageID", context.Data.Header.MessageId);

//context.Properties.Add ("SoapAction", "");

// Create Message Header Properties

//context.Properties.Add ("SourceSystemID", "");
//context.Properties.Add ("TransactionID", "");
//context.Properties.Add ("MaterialLots", "");

// Create Message Header Lookup Properties

// Create Message Body Properties
//context.Properties.Add ("PlantID", "");
context.Properties.Add ("MaterialID", "");
context.Properties.Add ("MaterialLotID", "");
context.Properties.Add ("StatusID", "");
context.Properties.Add ("StatusDescription", "");
context.Properties.Add ("EngineeringUnitID", "");
context.Properties.Add ("Potency", "");
context.Properties.Add ("SupplierID", "");
context.Properties.Add ("SupplierName", "");
context.Properties.Add ("SupplierLotID", "");
context.Properties.Add ("LastUpdateDateTime", "");
context.Properties.Add ("ReferencedLots", "");

// Create Message Body Lookup Properties

context.Properties.Add ("FacilityUID", "");
context.Properties.Add ("PlantCodeUID", "");
context.Properties.Add ("MaterialMasterUID", "");
context.Properties.Add ("NeoMaterialType", "");
context.Properties.Add ("MaterialLotUID", "");
context.Properties.Add ("StatusUID", "");
context.Properties.Add ("EngineeringUnitUID", "");
context.Properties.Add ("RevaluationDateUtc","");
//context.Properties.Add ("LocalServiceURI", "");

// Create Reference Lot Properties

context.Properties.Add ("ReferencedLotSourceSystemID", "");
context.Properties.Add ("ReferencedLotPlantID", "");
context.Properties.Add ("ReferencedLotMaterialID", "");
context.Properties.Add ("ReferencedLotMaterialLotID", "");

// Create Reference Lot Lookup Properties

context.Properties.Add ("ReferencedLotFacilityUID", "");
context.Properties.Add ("ReferencedLotPlantCodeUID", "");
context.Properties.Add ("ReferencedLotMaterialUID", "");
context.Properties.Add ("ReferencedLotNeoMaterialType", "");
context.Properties.Add ("ReferencedLotMaterialLotUID", "");
context.Properties.Add ("ReferencedLotLocalServiceURI", "");
context.Properties.Add ("ReferencedLotMaterialLotAncestorUID", "");
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typecddaa3b18514a60aed21b6bec94448&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;840c6853-4425-45ff-8b03-bfe7cc1643de&lt;/Id&gt;&lt;Name&gt;Comments&lt;/Name&gt;&lt;Uniquename&gt;cfca813c-1a6c-4e87-b332-580b8dafb9f5&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;//CREATED : 2/10/2016
//AUTHOR  : Michael Figura
//VERSION : 1.0
//PURPOSE : To enrich a Neo PLM ERP Material Lot XML message with the GUID
//and unique ID values required to do inserts and updates to Material Lots,
//as well as any Material Lots they might reference.

//-----------------------------OVERVIEW------------------------------------
//This code follows a basic enrichment pattern with error handling for
//both business level exceptions (bad data), and system exceptions.

//A series of lookups are performed using input parameter values contained
//in the source input XML file. Each time a REST call is made to a backend
//system, the code will output a trace of the values used for that call, 
//as well as the values returned. This trace code only runs if the debug
//environment variable is set to "True". The Dev deployment group should
//always be set to true. It is up to the QA team to decide if it is false
//during their testing process. It is always false in production.

//When errors occur they can be of type 1 (System Error) or type 2 (Business Error)
// Type 1 errors cause the entire processing to halt and retries are performed.
// Type 2 errors cause an email to be sent, but processing on the remaining records continues

//---------------------------TRACE FORMAT----------------------------------
//The trace message will illustrate the following format:

//Input Source System ID: Europe2
//Input Plant ID: BEP7
//Enriched Facility UID: 583e37ac-a220-4871-b1af-3db62c98948b
//Enriched Plant Code UID: 481r2rac-b447-8945-c7t5-4ghr22787yg4
//Input Material ID: 12345
//Enriched Material Master UID: b25ff6da-253c-40f9-b0ab-09524b1dae78

//..and so on until the end of the process.

//Tracing will occur for any and all exceptions, whether they be business
//or system level. You may also reference the NeoErrors database for a 
//quick glance at results, rather than sifting through the entire trace
//log. But the Error DB only populates if Debug is set to True.

context.Properties.Add ("PipelineException", "");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type9eff8e6442b4ab7aeebe70c8a7a794&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;986f0757-6048-4bc7-9cb2-f65eb0ec922a&lt;/Id&gt;&lt;Name&gt;Read Message Header Variables&lt;/Name&gt;&lt;Uniquename&gt;0b4e561f-1671-4a2f-985a-be75a8f0f140&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation("Start of Process_ERP_MaterialLot_Enrichment_Item_Read Message Header Variables");

String prefix ="workflow";

String propName = "";
//if(context.Data.Header.Action.Length &amp;gt; 0) 

//{ context.Properties["SoapAction"] = context.Data.Header.Action; }

////Load the Source System ID and Transaction ID
propName = "SourceSystemID";
context.Properties.Add(propName,context.Data.GetProperty(prefix, propName));
propName = "TransactionID";
context.Properties.Add(propName,context.Data.GetProperty(prefix, propName));
propName = "PlantID";
context.Properties.Add(propName,context.Data.GetProperty(prefix, propName));

//// Begin tracing
//context.Instance.TraceInformation("Process Material Lot Transaction ID: " + context.Properties["TransactionID"] + "Material Lots Count: " + materialLots.Count.ToString());

System.Xml.XmlNode materialLot = (System.Xml.XmlNode)context.Properties["CurrentProcessItem"];
context.Properties["MaterialLot"] = materialLot;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type6f01709dad2402bb4b6571118ee560&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;160b61b8-8060-4e9e-bcec-a120b438d440&lt;/Id&gt;&lt;Name&gt;Read Message Body&lt;/Name&gt;&lt;Uniquename&gt;9b20866d-009c-401f-97fc-b0686580dc7d&lt;/Uniquename&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Initialize the Transaction Properties to empty values

//context.Properties ["PlantID"] = "";
context.Properties ["MaterialID"] = "";
context.Properties ["MaterialLotID"] = "";
context.Properties ["StatusID"] = "";
context.Properties ["StatusDescription"] = "";
context.Properties ["EngineeringUnitID"] = "";
context.Properties ["Potency"] = "";
context.Properties ["SupplierID"] = "";
context.Properties ["SupplierName"] = "";
context.Properties ["SupplierLotID"] = "";
context.Properties ["LastUpdateDateTime"] = "";
context.Properties ["ReferencedLots"] = "";
context.Properties ["RevaluationDateUtc"] = "";
context.Properties ["FacilityUID"] = "";
context.Properties ["PlantCodeUID"] = "";
context.Properties ["MaterialMasterUID"] = "";
context.Properties ["MaterialLotUID"] = "";
context.Properties ["StatusUID"] = "";
context.Properties ["EngineeringUnitUID"] = "";



//Load the Material Lot
var materialLot = (System.Xml.XmlNode)context.Properties["MaterialLot"];

// Plant ID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "PlantID") { context.Properties["PlantID"] = node.InnerText; break; } }

// Revaluation Date
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "RevaluationDateUtc"){ context.Properties["RevaluationDateUtc"] = node.InnerText; break ; } }

//Material ID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if (node.Name == "MaterialID") { context.Properties["MaterialID"] = node.InnerText; break; } }


//Material Lot ID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "MaterialLotID") { context.Properties["MaterialLotID"] = node.InnerText; break; } }

//Status ID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "StatusCode") { context.Properties["StatusID"] = node.InnerText; break; } }

//Status Description
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "StatusDescription") { context.Properties["StatusDescription"] = node.InnerText; break; } }

//Engineering Unit ID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "PotencyUOM") { context.Properties["EngineeringUnitID"] = node.InnerText; break; } }

//Potency
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if (node.Name == "Potency") {context.Properties["Potency"] = node.InnerText; break; } }

// Supplier ID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "SupplierID") { context.Properties["SupplierID"] = node.InnerText; break;  } }

// Supplier Name
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "SupplierName") { context.Properties["SupplierName"] = node.InnerText; break;  } }

// Supplier Lot ID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "SupplierLotID") { context.Properties["SupplierLotID"] = node.InnerText; break;  } }

// Last Updated Date Time
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if (node.Name == "LastUpdateDateTime") { context.Properties["LastUpdateDateTime"] = node.InnerText; break;  } }

// Referenced Lots
foreach(System.Xml.XmlNode xNode in materialLot.ChildNodes) { if(xNode.Name == "ReferencedLots") { context.Properties["ReferencedLots"] = xNode; break; } }

//********************************Business Rule!! - Potency and Engineering Unit
if(context.Properties["Potency"].ToString().Length == 0 &amp;amp;&amp;amp; context.Properties["EngineeringUnitID"].ToString().Length == 0)
{
	context.Properties["Potency"] = "100";
	context.Properties["EngineeringUnitID"] = "P1";

}
else if (context.Properties["Potency"].ToString().Length == 0 &amp;amp;&amp;amp; context.Properties["EngineeringUnitID"].ToString().Length != 0)
{
	context.Properties["Potency"] = "100";	
}
else if (context.Properties["Potency"].ToString().Length != 0 &amp;amp;&amp;amp; context.Properties["EngineeringUnitID"].ToString().Length == 0)
	context.Properties["EngineeringUnitID"] = "P1";
&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type71a31839f0e4065a27b5fedb808af3&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d6p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d6p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;84959afe-3a05-4afa-ba31-a7afd9d39d23&lt;/Id&gt;&lt;Name&gt;Trace Transaction Values&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " Plant ID: " + context.Properties["PlantID"]);
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " Material ID: " + context.Properties["MaterialID"]);
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " Material Lot ID: " + context.Properties["MaterialLotID"]);
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " Status ID: " + context.Properties["StatusID"]);
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " Status Description: " + context.Properties["StatusDescription"]);
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " Potency UOM: " + context.Properties["EngineeringUnitID"]);
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " Potency: " + context.Properties["Potency"]);
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " SupplierID: " + context.Properties["SupplierID"]);
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " SupplierName: " + context.Properties["SupplierName"]);
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " LastUpdateDateTime: " + context.Properties["LastUpdateDateTime"]);

if (context.Properties["ReferencedLots"].ToString() != "")
{
	System.Xml.XmlNode referencedLots = (System.Xml.XmlNode) context.Properties["ReferencedLots"];

	context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " Referenced Lots: " + referencedLots.OuterXml.ToString());
	context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " Referenced Lots Count: " + referencedLots.ChildNodes.Count);
}
else
{
	context.Instance.TraceInformation ("Process Material LotProcess Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " There are no Referenced Lot on this transaction.");
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d7p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d7p1:string&gt;Neuron&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Pipelines&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Neuron.Esb&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d7p1:string&gt;&lt;d7p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d7p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typead44a7581894525b364db79bf01c57&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d7p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;346e2249-1c36-4793-8bb4-ed27fad5153c&lt;/Id&gt;&lt;Name&gt;Check Potency&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;double potencyValue = Convert.ToDouble(context.Properties["Potency"].ToString());
if (potencyValue &amp;gt;= 0 &amp;amp;&amp;amp; potencyValue &amp;lt;= 105){
	return true;
}
else {
	return false ;
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d10p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d10p1:string&gt;Neuron&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Neuron.Pipelines&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Neuron.Esb&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d10p1:string&gt;&lt;d10p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d10p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Id&gt;77e60705-9982-420c-a6ac-25e8f8e85f3e&lt;/Id&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0bc472e2-c246-4cbe-bf4c-8e4f0580eafa&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d11p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d11p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d12p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;525dd9fe-fd86-440a-bc2e-01596c84bd96&lt;/Id&gt;&lt;Name&gt;Map To Validate Transaction Date&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d12p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string dateTimeValidationRequestTemplate = context.Configuration.XmlDocs["DateTimeValidationRequest"].Xml;
	
System.Xml.XmlNode node = (System.Xml.XmlNode) context.Properties["MaterialLot"];

string message = System.Net.WebUtility.HtmlEncode (node.OuterXml.ToString());

// Create the response message
string dateTimeValidationRequest = string.Format(dateTimeValidationRequestTemplate, context.Properties["TransactionID"], context.Properties["SourceSystemID"], context.Properties["PlantID"], "LastUpdateTime: ", context.Properties["LastUpdateDateTime"].ToString(), message);

//Send the trace message to document the response message.
context.Instance.TraceInformation ("Process Material Lot - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + dateTimeValidationRequest);
	
// Set message context to the response message 	
context.Data.Text = dateTimeValidationRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d12p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d12p1:string&gt;Neuron&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Neuron.Pipelines&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Neuron.Esb&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d12p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type4b642b7ca46479aba4f600ef55b41f&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d11p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d11p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d12p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;a3bd0aa8-322a-4e49-8bf5-74cf5cee18b8&lt;/Id&gt;&lt;Name&gt;Validate Date&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d11p1:FileName i:nil="true" /&gt;&lt;d11p1:MaxInstances&gt;100&lt;/d11p1:MaxInstances&gt;&lt;d11p1:PipelineName&gt;Validate Date Time Format&lt;/d11p1:PipelineName&gt;&lt;d11p1:PoolTimeout&gt;PT1M&lt;/d11p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d12p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;664dd7e9-90f1-46e8-af89-905a9e211a89&lt;/Id&gt;&lt;Name&gt;Decision&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;if (context.Data.GetProperty("Neo", "DateTimeValid").ToUpper() == "TRUE")
	return true;
else
	return false;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d15p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d15p1:string&gt;Neuron&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Pipelines&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Neuron.Esb&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d15p1:string&gt;&lt;d15p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d15p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;a675b9e8-9c46-4eae-976e-637806a62550&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d16p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d16p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d17p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;f8485f16-dccc-4f0b-a076-da4583c3795e&lt;/Id&gt;&lt;Name&gt;Map to Material Master Composite&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d17p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string materialMasterRequestTemplate = context.Configuration.XmlDocs["MasterMasterCompositeRequest"].Xml;

System.Xml.XmlNode node = (System.Xml.XmlNode) context.Properties["MaterialLot"];

string message = System.Net.WebUtility.HtmlEncode (node.OuterXml.ToString());

// Create the response message
string materialMasterRequest = string.Format(materialMasterRequestTemplate, context.Properties["TransactionID"], context.Properties["SourceSystemID"], context.Properties["PlantID"], context.Properties["MaterialID"], "false", message);

//Send the trace message to document the response message.
context.Instance.TraceInformation ("Process Material Lot - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + materialMasterRequest);
	
// Set message context to the response message 	
context.Data.Text = materialMasterRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d17p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d17p1:string&gt;Neuron&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Neuron.Pipelines&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Neuron.Esb&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d17p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type37101cfe448494cb0125c813a04945&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d16p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d16p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d17p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;fa245bca-f932-4197-870c-5a70679a0690&lt;/Id&gt;&lt;Name&gt;Material Master Composite&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d16p1:FileName i:nil="true" /&gt;&lt;d16p1:MaxInstances&gt;100&lt;/d16p1:MaxInstances&gt;&lt;d16p1:PipelineName&gt;Process_GetMaterialMasterComposite&lt;/d16p1:PipelineName&gt;&lt;d16p1:PoolTimeout&gt;PT1M&lt;/d16p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d16p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d16p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d17p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;25a7c4a8-fd95-420c-adb7-92ca3d4736b8&lt;/Id&gt;&lt;Name&gt;Map From Material Master Composite&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d17p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;//string facilityUID = context.Data.GetProperty("NeoPLM", "FacilityUID");
//context.Properties ["FacilityUID"] = facilityUID;
//context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " FacilityUID: " + context.Properties["FacilityUID"]);

//string plantCodeUID = context.Data.GetProperty("NeoPLM", "PlantCodeUID");
//context.Properties ["PlantCodeUID"] = plantCodeUID;
//context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " PlantCodeUID: " + context.Properties["PlantCodeUID"]);

//string materialUID = context.Data.GetProperty("NeoPLM", "MaterialUID");
//context.Properties ["MaterialMasterUID"] = materialUID;
//context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " MaterialUID: " + context.Properties["MaterialMasterUID"]);

//string neoMaterialType = context.Data.GetProperty("NeoPLM", "NeoMaterialType");
//context.Properties ["NeoMaterialType"] = neoMaterialType;
//context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " NeoMaterialType: " + context.Properties["NeoMaterialType"]);

&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d17p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d17p1:string&gt;Neuron&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Neuron.Pipelines&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Neuron.Esb&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d17p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type33682111aa0455a8c7246274422399&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d17p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;13a1f0db-a298-4aff-899f-09784def9eec&lt;/Id&gt;&lt;Name&gt;Decision&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;if (context.Data.GetProperty("NeoPLM", "LookupError").ToUpper() == "FALSE")
	return true;
else
	return false;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d20p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d20p1:string&gt;Neuron&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Pipelines&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Neuron.Esb&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d20p1:string&gt;&lt;d20p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d20p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;bed921a7-9dae-4165-a3b2-5c9bd4a2b5d0&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d21p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d21p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d22p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4e7bf5bd-f4f9-4f76-bd38-22b70fd4f0f6&lt;/Id&gt;&lt;Name&gt;Map To Status Lookup&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d22p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string materialMasterRequestTemplate = context.Configuration.XmlDocs["MaterialLotStatusRequest"].Xml;

System.Xml.XmlNode node = (System.Xml.XmlNode) context.Properties["MaterialLot"];

string message = System.Net.WebUtility.HtmlEncode (node.OuterXml.ToString());

// Create the response message
string materialMasterRequest = string.Format(materialMasterRequestTemplate, context.Properties["TransactionID"], context.Properties["SourceSystemID"], context.Properties["PlantID"], context.Properties["StatusID"], "false", message);

//Send the trace message to document the response message.
context.Instance.TraceInformation ("Process Material Lot - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + materialMasterRequest);
	
// Set message context to the response message 	
context.Data.Text = materialMasterRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d22p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d22p1:string&gt;Neuron&lt;/d22p1:string&gt;&lt;d22p1:string&gt;Neuron.Pipelines&lt;/d22p1:string&gt;&lt;d22p1:string&gt;Neuron.Esb&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d22p1:string&gt;&lt;d22p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d22p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typea8b6e3be2a844b28453667b3c845e5&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d21p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d21p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d22p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;95acb3fe-40ed-4f6d-ba39-f730df2a7081&lt;/Id&gt;&lt;Name&gt;Lookup Status&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d21p1:FileName i:nil="true" /&gt;&lt;d21p1:MaxInstances&gt;100&lt;/d21p1:MaxInstances&gt;&lt;d21p1:PipelineName&gt;Process_GetMaterialLotStatus - New&lt;/d21p1:PipelineName&gt;&lt;d21p1:PoolTimeout&gt;PT1M&lt;/d21p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d21p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d21p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d22p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;a9be2f4b-8550-4797-85d2-b8162fd6f33a&lt;/Id&gt;&lt;Name&gt;Map From Status Lookup&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d22p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string mlStatus = context.Data.ToXmlDocument().SelectSingleNode("/*[local-name()='MaterialLotStatusLookupResponse' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']/*[local-name()='NeoPLMStatus' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']").InnerText;

context.Properties ["StatusUID"] = mlStatus;

context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " Material Lot Status " + context.Properties["StatusUID"]);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d22p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d22p1:string&gt;Neuron&lt;/d22p1:string&gt;&lt;d22p1:string&gt;Neuron.Pipelines&lt;/d22p1:string&gt;&lt;d22p1:string&gt;Neuron.Esb&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d22p1:string&gt;&lt;d22p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d22p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type923bc944d8242d3bc66ba4a4fd010b&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d22p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;558d11b2-bf30-41f4-93cb-670f5e3fdb76&lt;/Id&gt;&lt;Name&gt;Decision&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;if (context.Data.GetProperty("NeoPLM", "LookupError").ToUpper() == "FALSE")
	return true;
else
	return false;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d25p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d25p1:string&gt;Neuron&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Pipelines&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Neuron.Esb&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d25p1:string&gt;&lt;d25p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d25p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;a71256f3-e6e6-406f-9c29-84f278b9f910&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d26p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d26p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d27p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;f4852c09-ddb4-42f0-bfea-74ea4c3df6ca&lt;/Id&gt;&lt;Name&gt;Map to EU Lookup&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d27p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string eURequestTemplate = context.Configuration.XmlDocs["EngineeringUnitRequest"].Xml;

System.Xml.XmlNode node = (System.Xml.XmlNode) context.Properties["MaterialLot"];

string message = System.Net.WebUtility.HtmlEncode (node.OuterXml.ToString());

// Create the response message
string eURequest = string.Format(eURequestTemplate, context.Properties["TransactionID"], context.Properties["SourceSystemID"], context.Properties["EngineeringUnitID"], "false", message);

//Send the trace message to document the response message.
context.Instance.TraceInformation ("Process Material Lot - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + eURequest);
	
// Set message context to the response message 	
context.Data.Text = eURequest;

// Add prop to by pass the error for PotencyUOM
context.Properties.Add("CalledFromMaterialLot", "True");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d27p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d27p1:string&gt;Neuron&lt;/d27p1:string&gt;&lt;d27p1:string&gt;Neuron.Pipelines&lt;/d27p1:string&gt;&lt;d27p1:string&gt;Neuron.Esb&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d27p1:string&gt;&lt;d27p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d27p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typec063e2bc0504a0789ccdf9945e8899&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d26p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d26p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d27p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;9b9ad36a-3b48-4317-903a-953e9f51d7f3&lt;/Id&gt;&lt;Name&gt;EU Lookup&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d26p1:FileName i:nil="true" /&gt;&lt;d26p1:MaxInstances&gt;100&lt;/d26p1:MaxInstances&gt;&lt;d26p1:PipelineName&gt;Process_GetEngineeringUID - New&lt;/d26p1:PipelineName&gt;&lt;d26p1:PoolTimeout&gt;PT1M&lt;/d26p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d26p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d26p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d27p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;624032ac-cb7f-44b0-ba7e-3d957a92e18b&lt;/Id&gt;&lt;Name&gt;Map From EU Lookup&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d27p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string eUUID = context.Data.ToXmlDocument().SelectSingleNode("/*[local-name()='EngineeringUnitLookupResponse' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']/*[local-name()='NeoPLMEngineeringUnitUID' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']").InnerText;

context.Instance.TraceInformation("Engineering Unit UID : " + eUUID);

if(eUUID != System.Guid.Empty.ToString()){
	// Not Empty then pass the UID
}
else{
	eUUID = System.Guid.Empty.ToString();
}

context.Properties ["EngineeringUnitUID"] = eUUID;

context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " Engineering Unit UID " + context.Properties["EngineeringUnitUID"]);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d27p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d27p1:string&gt;Neuron&lt;/d27p1:string&gt;&lt;d27p1:string&gt;Neuron.Pipelines&lt;/d27p1:string&gt;&lt;d27p1:string&gt;Neuron.Esb&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d27p1:string&gt;&lt;d27p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d27p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type539d214a1e34e79a6e860161cb99db&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d27p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;13df20d4-6f6d-44f2-a34c-94b992a857b9&lt;/Id&gt;&lt;Name&gt;Decision&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;if (context.Data.GetProperty("NeoPLM", "LookupError").ToUpper() == "FALSE")
	return true;
else
	return false;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d30p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d30p1:string&gt;Neuron&lt;/d30p1:string&gt;&lt;d30p1:string&gt;Neuron.Pipelines&lt;/d30p1:string&gt;&lt;d30p1:string&gt;Neuron.Esb&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d30p1:string&gt;&lt;d30p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d30p1:string&gt;&lt;d30p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d30p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d30p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ccc177ec-4343-4e60-97af-f2ef6dcbddfd&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d31p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d31p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d32p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;true&lt;/Disable&gt;&lt;Id&gt;6ff5ff80-3426-47cb-9fba-0c0dbf76b2f9&lt;/Id&gt;&lt;Name&gt;Map To Local URI&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d32p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string localServiceURIRequestTemplate = context.Configuration.XmlDocs["LocalServiceURIRequest"].Xml;
	
System.Xml.XmlNode node = (System.Xml.XmlNode) context.Properties["MaterialLot"];

string message = System.Net.WebUtility.HtmlEncode (node.OuterXml.ToString());

// Create the request message
string localServiceURIRequest = string.Format(localServiceURIRequestTemplate, context.Properties["TransactionID"], context.Properties["FacilityUID"], message);

//Send the trace message to document the request message.
context.Instance.TraceInformation ("Process Material Lot - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + localServiceURIRequest);
	
// Set message context to the request message 	
context.Data.Text = localServiceURIRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d32p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d32p1:string&gt;Neuron&lt;/d32p1:string&gt;&lt;d32p1:string&gt;Neuron.Pipelines&lt;/d32p1:string&gt;&lt;d32p1:string&gt;Neuron.Esb&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d32p1:string&gt;&lt;d32p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d32p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type462126ea05c4d04b42064c3255e287&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d31p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d31p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d32p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;true&lt;/Disable&gt;&lt;Id&gt;4e8a1a80-238b-46cc-9bd1-ef1a8fc63a25&lt;/Id&gt;&lt;Name&gt;Local URI&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d31p1:FileName i:nil="true" /&gt;&lt;d31p1:MaxInstances&gt;100&lt;/d31p1:MaxInstances&gt;&lt;d31p1:PipelineName&gt;Process_GetLocalServiceURI - New&lt;/d31p1:PipelineName&gt;&lt;d31p1:PoolTimeout&gt;PT1M&lt;/d31p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d31p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d31p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d32p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;true&lt;/Disable&gt;&lt;Id&gt;faa39b2c-811c-4017-a06b-c5c676ae9f2a&lt;/Id&gt;&lt;Name&gt;Map From Local URI&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d32p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string localServiceURI = context.Data.ToXmlDocument().SelectSingleNode("/*[local-name()='LocalServiceURIResponse' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']/*[local-name()='LocalServiceURI' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']").InnerText;

context.Properties ["LocalServiceURI"] = localServiceURI;

context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " LocalServiceURI: " + context.Properties["LocalServiceURI"]);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d32p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d32p1:string&gt;Neuron&lt;/d32p1:string&gt;&lt;d32p1:string&gt;Neuron.Pipelines&lt;/d32p1:string&gt;&lt;d32p1:string&gt;Neuron.Esb&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d32p1:string&gt;&lt;d32p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d32p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type9b5f9b02d894592bae05ea79ecad56&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d32p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;b4153fbd-febb-43e2-8356-5aa3cb45cead&lt;/Id&gt;&lt;Name&gt;Decision&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;if (context.Data.GetProperty("NeoPLM", "LookupError").ToUpper() == "FALSE")
	return true;
else
	return false;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d35p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d35p1:string&gt;Neuron&lt;/d35p1:string&gt;&lt;d35p1:string&gt;Neuron.Pipelines&lt;/d35p1:string&gt;&lt;d35p1:string&gt;Neuron.Esb&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d35p1:string&gt;&lt;d35p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d35p1:string&gt;&lt;d35p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d35p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d35p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;977e263a-a61c-4bbe-8c76-ac5a6370eb65&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d36p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d36p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d37p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;872d3690-e209-4975-8eae-a579b9602aa3&lt;/Id&gt;&lt;Name&gt;Map To Create Material Lot&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d37p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string materialLotRequestTemplate = context.Configuration.XmlDocs["MaterialLotSave"].Xml;

// This is a placeholder material Lot.  These properties are set to the default values below.
string externalStatus = context.Properties["StatusID"].ToString();
string externalStatusDescription = context.Properties["StatusDescription"].ToString();
string lotStatus = context.Properties["StatusUID"].ToString();
string potency = context.Properties["Potency"].ToString();
string potencyLabel = context.Properties["EngineeringUnitID"].ToString();
string potencyUnits = context.Properties["EngineeringUnitUID"].ToString();
string supplierID = context.Properties["SupplierID"].ToString();
string supplierName = System.Net.WebUtility.HtmlEncode (context.Properties["SupplierName"].ToString());
string supplierLotID = context.Properties["SupplierLotID"].ToString();
string lastModified = System.DateTime.UtcNow.ToString("yyyy-MM-ddTHH:mm:ssZ").ToString();

System.DateTime dt = System.DateTime.Parse(context.Properties["LastUpdateDateTime"].ToString());

string sourceLastModified = dt.ToUniversalTime().ToString ("yyyy-MM-ddTHH:mm:ssZ");

// Create the request message
string materialLotRequest = string.Format(materialLotRequestTemplate, "Create/Update", context.Properties["LocalServiceURI"], 
	                        context.Properties["MaterialLotID"], context.Properties["FacilityUID"], 
	                        context.Properties["PlantCodeUID"], context.Properties["MaterialMasterUID"], 
	                        context.Properties["NeoMaterialType"], externalStatus, externalStatusDescription, 
	                        lotStatus, potency, potencyLabel, potencyUnits, supplierID, supplierName, 
	                        supplierLotID, lastModified, sourceLastModified );

//Send the trace message to document the request message.
context.Instance.TraceInformation ("Process Material Lot - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + materialLotRequest);
	
// Set message context to the request message 	
context.Data.Text = materialLotRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d37p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d37p1:string&gt;Neuron&lt;/d37p1:string&gt;&lt;d37p1:string&gt;Neuron.Pipelines&lt;/d37p1:string&gt;&lt;d37p1:string&gt;Neuron.Esb&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d37p1:string&gt;&lt;d37p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d37p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type462126ea05c4d04b42064c3255e287&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d36p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d36p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d37p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;b503825f-6e7c-4cf5-8629-a62fbb082991&lt;/Id&gt;&lt;Name&gt;Create Material Lot&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d36p1:FileName i:nil="true" /&gt;&lt;d36p1:MaxInstances&gt;100&lt;/d36p1:MaxInstances&gt;&lt;d36p1:PipelineName&gt;Process_CreateUpdateMaterialLot&lt;/d36p1:PipelineName&gt;&lt;d36p1:PoolTimeout&gt;PT1M&lt;/d36p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d36p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d36p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d37p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;9e26ef4a-88f3-4f3d-9eca-73f8bf425511&lt;/Id&gt;&lt;Name&gt;Map From Material Lot &lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d37p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string materialLotUID = context.Data.GetProperty ("NeoPLM", "MaterialLotUID");

context.Properties ["MaterialLotUID"] = materialLotUID;

context.Instance.TraceInformation ("Process Operations Performance - Transaction ID: " + context.Properties["TransactionID"] + " MaterialLotUID: " + context.Properties["MaterialLotUID"]);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d37p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d37p1:string&gt;Neuron&lt;/d37p1:string&gt;&lt;d37p1:string&gt;Neuron.Pipelines&lt;/d37p1:string&gt;&lt;d37p1:string&gt;Neuron.Esb&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d37p1:string&gt;&lt;d37p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d37p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type9b5f9b02d894592bae05ea79ecad56&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d37p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;e9256592-7046-4080-bbb7-c68e26426e0c&lt;/Id&gt;&lt;Name&gt;Decision&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;		int count = 0;
		if (context.Properties["ReferencedLots"] != "")
		{		
			var referencedLots = (System.Xml.XmlNode)context.Properties["ReferencedLots"];
			count = referencedLots.ChildNodes.Count;
		}
		
		if (count &amp;gt; 0)
			return true;
		else
			return false;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d40p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d40p1:string&gt;Neuron&lt;/d40p1:string&gt;&lt;d40p1:string&gt;Neuron.Pipelines&lt;/d40p1:string&gt;&lt;d40p1:string&gt;Neuron.Esb&lt;/d40p1:string&gt;&lt;d40p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d40p1:string&gt;&lt;d40p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d40p1:string&gt;&lt;d40p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d40p1:string&gt;&lt;d40p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d40p1:string&gt;&lt;d40p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d40p1:string&gt;&lt;d40p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d40p1:string&gt;&lt;d40p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d40p1:string&gt;&lt;d40p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d40p1:string&gt;&lt;d40p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d40p1:string&gt;&lt;d40p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d40p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d40p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;dfe19b1d-bd76-4a14-8e59-2e2adc54cd7f&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep i:type="ForEachPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d42p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;67953ab6-9bc8-41dd-b659-69d77fe71d9a&lt;/Id&gt;&lt;Name&gt;ForEach&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d43p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d43p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d44p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;bafc0f70-fb6c-4fb5-9847-639ad69b6824&lt;/Id&gt;&lt;Name&gt;Initialize Properties&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d44p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;//Load the Material Lot
var materialLot = (System.Xml.XmlNode)context.Properties["ReferencedLot"];

context.Properties["ReferencedLotSourceSystemID"] = "";
context.Properties["ReferencedLotPlantID"] = "";
context.Properties["ReferencedLotMaterialID"] = "";
context.Properties["ReferencedLotMaterialLotID"] = "";

string sourceSystemID = "";
string plantCodeID = "";
string materialID = "";
string materialLotID = "";

//SourceSystemID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "SourceSystemID") { sourceSystemID = node.InnerText; break; } }

//SourceSystemID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "PlantID") { plantCodeID = node.InnerText; break; } }

//SourceSystemID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "MaterialID") { materialID = node.InnerText; break; } }

//SourceSystemID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "MaterialLotID") { materialLotID = node.InnerText; break; } }

context.Properties["ReferencedLotSourceSystemID"] = sourceSystemID;
context.Properties["ReferencedLotPlantID"] = plantCodeID;
context.Properties["ReferencedLotMaterialID"] = materialID;
context.Properties["ReferencedLotMaterialLotID"] = materialLotID;

context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " Referenced Source System ID: " + context.Properties["ReferencedLotSourceSystemID"]);
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " Referenced Plant Code ID: " + context.Properties["ReferencedLotPlantID"]);
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " Referenced MaterialID: " + context.Properties["ReferencedLotMaterialID"]);
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] +  " Referenced MaterialLotID: " + context.Properties["ReferencedLotMaterialLotID"]);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d44p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d44p1:string&gt;Neuron&lt;/d44p1:string&gt;&lt;d44p1:string&gt;Neuron.Pipelines&lt;/d44p1:string&gt;&lt;d44p1:string&gt;Neuron.Esb&lt;/d44p1:string&gt;&lt;d44p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d44p1:string&gt;&lt;d44p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d44p1:string&gt;&lt;d44p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d44p1:string&gt;&lt;d44p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d44p1:string&gt;&lt;d44p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d44p1:string&gt;&lt;d44p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d44p1:string&gt;&lt;d44p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d44p1:string&gt;&lt;d44p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d44p1:string&gt;&lt;d44p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d44p1:string&gt;&lt;d44p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d44p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type658e4f8c57e4b57b52b1f33da53abc&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d44p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;392682f3-38fb-4f2f-bf09-a6d4f893f067&lt;/Id&gt;&lt;Name&gt;Decision&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;if (context.Properties["ReferencedLotPlantID"].ToString().ToUpper() != "VENDOR")
	return true;
else
	return false;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d47p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d47p1:string&gt;Neuron&lt;/d47p1:string&gt;&lt;d47p1:string&gt;Neuron.Pipelines&lt;/d47p1:string&gt;&lt;d47p1:string&gt;Neuron.Esb&lt;/d47p1:string&gt;&lt;d47p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d47p1:string&gt;&lt;d47p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d47p1:string&gt;&lt;d47p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d47p1:string&gt;&lt;d47p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d47p1:string&gt;&lt;d47p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d47p1:string&gt;&lt;d47p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d47p1:string&gt;&lt;d47p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d47p1:string&gt;&lt;d47p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d47p1:string&gt;&lt;d47p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d47p1:string&gt;&lt;d47p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d47p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Internal Material Lot&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d47p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;b7d70477-0f90-4fad-afdd-58bdfeff3403&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d48p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d48p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d49p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;27e8a54f-762b-4f39-b40b-5144fe28f8fb&lt;/Id&gt;&lt;Name&gt;Map to Reference Lot Lookup&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d49p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;//Load the Material Lot
var materialLot = (System.Xml.XmlNode)context.Properties["ReferencedLot"];

string sourceSystemID = "";
string plantCodeID = "";
string materialID = "";
string materialLotID = "";

//SourceSystemID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "SourceSystemID") { sourceSystemID = node.InnerText; break; } }

//SourceSystemID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "PlantID") { plantCodeID = node.InnerText; break; } }

//SourceSystemID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "MaterialID") { materialID = node.InnerText; break; } }

//SourceSystemID
foreach(System.Xml.XmlNode node in materialLot.ChildNodes) { if(node.Name == "MaterialLotID") { materialLotID = node.InnerText; break; } }

// Retrieve the response template message
string materialMasterRequestTemplate = context.Configuration.XmlDocs["MasterMasterCompositeRequest"].Xml;

System.Xml.XmlNode messageNode = (System.Xml.XmlNode) context.Properties["MaterialLot"];

string message = System.Net.WebUtility.HtmlEncode (messageNode.OuterXml.ToString());

// Create the response message
string materialMasterRequest = string.Format(materialMasterRequestTemplate, context.Properties["TransactionID"], sourceSystemID, plantCodeID, materialID, "true", message);

//Send the trace message to document the response message.
context.Instance.TraceInformation ("Process Material Lot - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + materialMasterRequest);
	
// Set message context to the response message 	
context.Data.Text = materialMasterRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d49p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d49p1:string&gt;Neuron&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Neuron.Pipelines&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Neuron.Esb&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d49p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type07b8779e7f040f19ec9e76dd1f80eb&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d48p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d48p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d49p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;86fb1f7f-d392-45b0-ac8c-e1d042ca64f7&lt;/Id&gt;&lt;Name&gt;Referenced Lot Material Composite&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d48p1:FileName i:nil="true" /&gt;&lt;d48p1:MaxInstances&gt;100&lt;/d48p1:MaxInstances&gt;&lt;d48p1:PipelineName&gt;Process_GetMaterialMasterComposite&lt;/d48p1:PipelineName&gt;&lt;d48p1:PoolTimeout&gt;PT1M&lt;/d48p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d48p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d48p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d49p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;35c45df7-9884-4309-88a4-4a322952e805&lt;/Id&gt;&lt;Name&gt;Map From Referenced Lot Lookup&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d49p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string facilityUID = context.Data.GetProperty("NeoPLM", "FacilityUID");
context.Properties ["ReferencedLotFacilityUID"] = context.Properties["FacilityUID"];
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " Referenced Lot FacilityUID: " + context.Properties["ReferencedLotFacilityUID"]);

string plantCodeUID = context.Data.GetProperty("NeoPLM", "PlantCodeUID");
context.Properties ["ReferencedLotPlantCodeUID"] = context.Properties["PlantCodeUID"];
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " Referenced Lot PlantCodeUID: " + context.Properties["ReferencedLotPlantCodeUID"]);

string materialUID = context.Data.GetProperty("NeoPLM", "MaterialUID");
context.Properties ["ReferencedLotMaterialUID"] = context.Properties["MaterialUID"];
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " Referenced Lot MaterialUID: " + context.Properties["ReferencedLotMaterialUID"]);

string neoMaterialType = context.Data.GetProperty("NeoPLM", "NeoMaterialType");
context.Properties ["ReferencedLotNeoMaterialType"] = context.Properties["NeoMaterialType"];
context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " Referenced Lot NeoMaterialType: " + context.Properties["ReferencedLotNeoMaterialType"]);

&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d49p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d49p1:string&gt;Neuron&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Neuron.Pipelines&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Neuron.Esb&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d49p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typea6b20f589444f45841b22d29e8ef62&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d49p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;76dc5844-f6f5-4bc0-98a2-db2e197543b1&lt;/Id&gt;&lt;Name&gt;Decision&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;if (context.Properties["ReferencedLotFacilityUID"].ToString()  != System.Guid.Empty.ToString() &amp;amp;&amp;amp;
	context.Properties["ReferencedLotPlantCodeUID"].ToString() != System.Guid.Empty.ToString() &amp;amp;&amp;amp;
	context.Properties["ReferencedLotMaterialUID"].ToString() != System.Guid.Empty.ToString()) 
{
	return true;
}
else
{
	return false;
}&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d52p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d52p1:string&gt;Neuron&lt;/d52p1:string&gt;&lt;d52p1:string&gt;Neuron.Pipelines&lt;/d52p1:string&gt;&lt;d52p1:string&gt;Neuron.Esb&lt;/d52p1:string&gt;&lt;d52p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d52p1:string&gt;&lt;d52p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d52p1:string&gt;&lt;d52p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d52p1:string&gt;&lt;d52p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d52p1:string&gt;&lt;d52p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d52p1:string&gt;&lt;d52p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d52p1:string&gt;&lt;d52p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d52p1:string&gt;&lt;d52p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d52p1:string&gt;&lt;d52p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d52p1:string&gt;&lt;d52p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d52p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;If&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d52p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;4a0b7de6-5632-4bff-a671-b34dd15e0634&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d53p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d53p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d54p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;30dacf2b-43a5-4370-9ebf-95bcad9ac2e1&lt;/Id&gt;&lt;Name&gt;Map To Local URI&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string localServiceURIRequestTemplate = context.Configuration.XmlDocs["LocalServiceURIRequest"].Xml;
	
System.Xml.XmlNode node = (System.Xml.XmlNode) context.Properties["MaterialLot"];

string message = System.Net.WebUtility.HtmlEncode (node.OuterXml.ToString());

// Create the request message
string localServiceURIRequest = string.Format(localServiceURIRequestTemplate, context.Properties["TransactionID"], context.Properties["ReferencedLotFacilityUID"], message);

//Send the trace message to document the request message.
context.Instance.TraceInformation ("Process Material Lot - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + localServiceURIRequest);
	
// Set message context to the request message 	
context.Data.Text = localServiceURIRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d54p1:string&gt;Neuron&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Pipelines&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Esb&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d54p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type462126ea05c4d04b42064c3255e287&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d53p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d53p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d54p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;b7ce8e44-e40b-47db-8c7d-85dc172fd887&lt;/Id&gt;&lt;Name&gt;Local URI&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d53p1:FileName i:nil="true" /&gt;&lt;d53p1:MaxInstances&gt;100&lt;/d53p1:MaxInstances&gt;&lt;d53p1:PipelineName&gt;Process_GetLocalServiceURI - New&lt;/d53p1:PipelineName&gt;&lt;d53p1:PoolTimeout&gt;PT1M&lt;/d53p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d53p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d53p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d54p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;fc6acc18-312f-4167-a705-7f6cf513dbbf&lt;/Id&gt;&lt;Name&gt;Map From Local URI&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string localServiceURI = context.Data.ToXmlDocument().SelectSingleNode("/*[local-name()='LocalServiceURIResponse' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']/*[local-name()='LocalServiceURI' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']").InnerText;

context.Properties ["ReferencedLotLocalServiceURI"] = localServiceURI;

context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " Referenced LotLocalServiceURI: " + context.Properties["ReferencedLotLocalServiceURI"]);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d54p1:string&gt;Neuron&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Pipelines&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Esb&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d54p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type9b5f9b02d894592bae05ea79ecad56&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d53p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d53p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d54p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;fe164fdf-cb41-4732-82f8-a5402951ff85&lt;/Id&gt;&lt;Name&gt;Map To Create Referenced Material Lot&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string materialLotRequestTemplate = context.Configuration.XmlDocs["MaterialLotSave"].Xml;

// This is a placeholder material Lot.  These properties are set to the default values below.
string externalStatus = "";
string externalStatusDescription = "";
string lotStatus = "20";
string potency = "100";
string potencyLabel = "";
string potencyUnits = System.Guid.Empty.ToString();
string supplierID = "";
string supplierName = "";
string supplierLotID = "";
string lastModified = System.DateTime.UtcNow.ToString("yyyy-MM-ddTHH:mm:ssZ");

System.DateTime dt = System.DateTime.Parse(context.Properties["LastUpdateDateTime"].ToString());

string sourceLastModified = dt.ToUniversalTime().ToString ("yyyy-MM-ddTHH:mm:ssZ");

// Create the request message
string materialLotRequest = string.Format(materialLotRequestTemplate, "Create", context.Properties["ReferencedLotLocalServiceURI"], 
	                        context.Properties["ReferencedLotMaterialLotID"], context.Properties["ReferencedLotFacilityUID"], 
	                        context.Properties["ReferencedLotPlantCodeUID"], context.Properties["ReferencedLotMaterialUID"], 
	                        context.Properties["ReferencedLotNeoMaterialType"], externalStatus, externalStatusDescription, 
	                        lotStatus, potency, potencyLabel, potencyUnits, supplierID, supplierName, 
	                        supplierLotID, lastModified, sourceLastModified );

//Send the trace message to document the request message.
context.Instance.TraceInformation ("Process Material Lot - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + materialLotRequest);
	
// Set message context to the request message 	
context.Data.Text = materialLotRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d54p1:string&gt;Neuron&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Pipelines&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Esb&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d54p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type7b9ea41dd4b4ed293caf0dbbd42b76&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d53p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d53p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d54p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;cebd2251-3bb3-4790-b272-3c0720f50040&lt;/Id&gt;&lt;Name&gt;Create Referenced Material Lot&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d53p1:FileName i:nil="true" /&gt;&lt;d53p1:MaxInstances&gt;100&lt;/d53p1:MaxInstances&gt;&lt;d53p1:PipelineName&gt;Process_CreateUpdateMaterialLot&lt;/d53p1:PipelineName&gt;&lt;d53p1:PoolTimeout&gt;PT1M&lt;/d53p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d53p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d53p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d54p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ed6bc61e-8196-4a13-b9ab-0720324bfd4e&lt;/Id&gt;&lt;Name&gt;Map From Create Material Lot&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string materialLotUID = context.Data.GetProperty ("NeoPLM", "MaterialLotUID");

context.Properties ["ReferencedLotMaterialLotUID"] = materialLotUID;

context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " Referenced MaterialLotUID: " + context.Properties["ReferencedLotMaterialLotUID"]);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d54p1:string&gt;Neuron&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Pipelines&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Esb&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d54p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typece568c3124e4400a5ac44bc4bf86e0&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d53p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d53p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d54p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;3e0b191f-b926-43da-a1c9-b261c9e2bc29&lt;/Id&gt;&lt;Name&gt;Map To Create Material Lot Ancestor Maps&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string mLAMRequestTemplate = context.Configuration.XmlDocs["MaterialLotAncestorMapSaveRequest"].Xml;

// Create the request message
string mLAMRequest = string.Format(mLAMRequestTemplate, "Create", context.Properties["LocalServiceURI"], 
	                        context.Properties["MaterialLotUID"], context.Properties["ReferencedLotMaterialLotUID"], 
	                        context.Properties["ReferencedLotFacilityUID"], "");

//Send the trace message to document the request message.
context.Instance.TraceInformation ("Process Material Lot - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + mLAMRequest);
	
// Set message context to the request message 	
context.Data.Text = mLAMRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d54p1:string&gt;Neuron&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Pipelines&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Esb&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d54p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type7b9ea41dd4b4ed293caf0dbbd42b76&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d53p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d53p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d54p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;f61939cd-56d0-4eec-9916-01119811e0bd&lt;/Id&gt;&lt;Name&gt;Create Material Lot Ancestor Map&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d53p1:FileName i:nil="true" /&gt;&lt;d53p1:MaxInstances&gt;100&lt;/d53p1:MaxInstances&gt;&lt;d53p1:PipelineName&gt;Process_CreateUpdateMaterialLotAncestors&lt;/d53p1:PipelineName&gt;&lt;d53p1:PoolTimeout&gt;PT1M&lt;/d53p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d53p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d53p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d54p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d8c457c5-58d4-42ae-988e-0e216cd9a3cc&lt;/Id&gt;&lt;Name&gt;Map From Create Material Lot Ancestor Map&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string mLAMUID = context.Data.GetProperty ("NeoPLM", "MaterialLotAncestorMapUID");

context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " Referenced MaterialLotAncestorMapUID: " + mLAMUID);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d54p1:string&gt;Neuron&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Pipelines&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Esb&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d54p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typece568c3124e4400a5ac44bc4bf86e0&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d52p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5c640ae6-0ad3-4421-9301-7d07872cedc5&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d53p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d53p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d54p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;7792f1ce-656f-4402-a93b-c3398342b579&lt;/Id&gt;&lt;Name&gt;Map To Get Referenced Material Lot&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string mLAMRequestTemplate = context.Configuration.XmlDocs["MaterialLotAncestorRequest"].Xml;

// Create the request message
string mLAMRequest = string.Format (mLAMRequestTemplate, context.Properties["TransactionID"], 
	                                context.Properties["LocalServiceURI"], context.Properties["MaterialLotUID"], 
									System.Guid.Empty.ToString(), "true", context.Properties["MaterialLot"].ToString());

//Send the trace message to document the request message.
context.Instance.TraceInformation ("Process Material Lot - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + mLAMRequest);
	
// Set message context to the request message 	
context.Data.Text = mLAMRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d54p1:string&gt;Neuron&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Pipelines&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Esb&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d54p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type7b9ea41dd4b4ed293caf0dbbd42b76&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d53p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d53p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d54p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;ff3a4f62-79b1-4dab-bd74-2d19a64891d7&lt;/Id&gt;&lt;Name&gt;Get Referenced Material Lot Map&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d53p1:FileName i:nil="true" /&gt;&lt;d53p1:MaxInstances&gt;100&lt;/d53p1:MaxInstances&gt;&lt;d53p1:PipelineName&gt;Process_GetMaterialLotAncestors-New&lt;/d53p1:PipelineName&gt;&lt;d53p1:PoolTimeout&gt;PT1M&lt;/d53p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d53p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d53p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d54p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;2d4185a7-49d1-40c5-9337-fe39496a0a0d&lt;/Id&gt;&lt;Name&gt;Map From Get ML Ancestor&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string uid = context.Data.ToXmlDocument().SelectSingleNode("/*[local-name()='MaterialLotAncestorResponse' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']/*[local-name()='UID' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']").InnerText;

context.Properties["ReferencedLotMaterialLotAncestorUID"] = uid;

context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " Referenced MaterialLotAncestorMapUID: " + context.Properties["ReferencedLotMaterialLotAncestorUID"]);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d54p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d54p1:string&gt;Neuron&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Pipelines&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Neuron.Esb&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d54p1:string&gt;&lt;d54p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d54p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typece568c3124e4400a5ac44bc4bf86e0&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep i:type="DecisionPipelineStepOfESBMessagexAPWb1W4"&gt;&lt;Bindings xmlns:d54p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;a714fda1-a363-431b-949f-8e50dced715a&lt;/Id&gt;&lt;Name&gt;Decision&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Branches&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="CodeBranchConditionOfESBMessagexAPWb1W4"&gt;&lt;Code&gt;if (context.Properties["ReferencedLotMaterialLotAncestorUID"].ToString() == System.Guid.Empty.ToString())
	return true;
else
	return false;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d57p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d57p1:string&gt;Neuron&lt;/d57p1:string&gt;&lt;d57p1:string&gt;Neuron.Pipelines&lt;/d57p1:string&gt;&lt;d57p1:string&gt;Neuron.Esb&lt;/d57p1:string&gt;&lt;d57p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d57p1:string&gt;&lt;d57p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d57p1:string&gt;&lt;d57p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d57p1:string&gt;&lt;d57p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d57p1:string&gt;&lt;d57p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d57p1:string&gt;&lt;d57p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d57p1:string&gt;&lt;d57p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d57p1:string&gt;&lt;d57p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d57p1:string&gt;&lt;d57p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d57p1:string&gt;&lt;d57p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d57p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;/Condition&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Create Additional Data&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d57p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;eb92cb3c-dc0d-4716-a593-b1f9af9b7701&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d58p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d58p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d59p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;91a07caa-4118-4417-80ee-980ea41cf673&lt;/Id&gt;&lt;Name&gt;Map To Create ML Ancestor Map&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d59p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string mLAMRequestTemplate = context.Configuration.XmlDocs["MaterialLotAncestorMapSaveRequest"].Xml;

// Retrieve the Referenced Lot Template
string additionalDataTemplate = context.Configuration.XmlDocs["ReferencedLotTemplate"].Xml;

string additionalData = "&amp;lt;ReferencedLots&amp;gt;";

additionalData = additionalData + string.Format(additionalDataTemplate, context.Properties["ReferencedLotSourceSystemID"], 
	                        context.Properties["ReferencedLotPlantID"], context.Properties["ReferencedLotMaterialID"], 
	                        context.Properties["ReferencedLotMaterialLotID"]);

additionalData = additionalData + "&amp;lt;/ReferencedLots&amp;gt;";

additionalData = System.Net.WebUtility.HtmlEncode (additionalData);

// Create the request message
string mLAMRequest = string.Format(mLAMRequestTemplate, "Create", context.Properties["LocalServiceURI"], 
	                        context.Properties["MaterialLotUID"], System.Guid.Empty.ToString(), 
	                        context.Properties["ReferencedLotFacilityUID"], additionalData);

//Send the trace message to document the request message.
context.Instance.TraceInformation ("Process Material Lot - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + mLAMRequest);
	
// Set message context to the request message 	
context.Data.Text = mLAMRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d59p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d59p1:string&gt;Neuron&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Neuron.Pipelines&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Neuron.Esb&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d59p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type53d7bb09f5b4e459d29b1eea21b471&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d58p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d58p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d59p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;75c078fc-ef34-439d-b91b-61c85761a975&lt;/Id&gt;&lt;Name&gt;Create ML Ancestor Map&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d58p1:FileName i:nil="true" /&gt;&lt;d58p1:MaxInstances&gt;100&lt;/d58p1:MaxInstances&gt;&lt;d58p1:PipelineName&gt;Process_CreateUpdateMaterialLotAncestors&lt;/d58p1:PipelineName&gt;&lt;d58p1:PoolTimeout&gt;PT1M&lt;/d58p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d58p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d58p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d59p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;b48e2881-5410-4061-8d02-1109359b81cf&lt;/Id&gt;&lt;Name&gt;Map From Create Ancestor Map&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d59p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string mLAMUID = context.Data.GetProperty ("NeoPLM", "MaterialLotAncestorMapUID");

context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " Referenced MaterialLotAncestorMapUID: " + mLAMUID);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d59p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d59p1:string&gt;Neuron&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Neuron.Pipelines&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Neuron.Esb&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d59p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typeb6bc01bb6934ac4aaded15aa7b2612&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Append Additional Data&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d57p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;f54b6297-9be4-4ae1-881d-ec34222cd515&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d58p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d58p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d59p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;f021ef29-0510-4391-82f7-15df484ba852&lt;/Id&gt;&lt;Name&gt;Map to Update ML Ancestor&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d59p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string sourceSystemID = "";
string plantCodeID = "";
string materialID = "";
string materialLotID = "";
string additionalData = "";

// Retrieve the response template message
string mLAMRequestTemplate = context.Configuration.XmlDocs["MaterialLotAncestorMapSaveRequest"].Xml;

// Retrieve the Referenced Lot Template
string additionalDataTemplate = context.Configuration.XmlDocs["ReferencedLotTemplate"].Xml;

string moreAdditionalData = string.Format(additionalDataTemplate, context.Properties["ReferencedLotSourceSystemID"], 
	                        context.Properties["ReferencedLotPlantID"], context.Properties["ReferencedLotMaterialID"], 
	                        context.Properties["ReferencedLotMaterialLotID"]);

string priorAdditionalData = context.Data.ToXmlDocument().SelectSingleNode("/*[local-name()='MaterialLotAncestorResponse' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']/*[local-name()='AdditionalData' and namespace-uri()='http://NeoPLM.com/EnterpriseIntegration']").InnerText;

priorAdditionalData = System.Net.WebUtility.HtmlDecode (priorAdditionalData);
context.Instance.TraceInformation (priorAdditionalData);

try
{

	// Load the previous state of the additional Data
	
	System.Xml.XmlDocument xDoc = new XmlDocument();
	xDoc.LoadXml (priorAdditionalData);
	

	context.Instance.TraceInformation ("Root Node: " + xDoc.DocumentElement.Name);
	if (xDoc.DocumentElement.Name == "ReferencedLots")
	{
		bool isMatch = false;
		foreach (System.Xml.XmlNode rLNode in xDoc.ChildNodes)
		{
			foreach (System.Xml.XmlNode cNode in rLNode.ChildNodes)
			{
				
			// SourceSystemID
			foreach(System.Xml.XmlNode node in cNode.ChildNodes) { 
				context.Instance.TraceInformation (node.LocalName);
				if(node.LocalName == "SourceSystemID") { sourceSystemID = node.InnerText; break; } 
			}
		
			// PlantID
			foreach(System.Xml.XmlNode node in cNode.ChildNodes) { if(node.LocalName == "PlantID") { plantCodeID = node.InnerText; break; } }

			// Material ID
			foreach(System.Xml.XmlNode node in cNode.ChildNodes) { if(node.LocalName == "MaterialID") { materialID = node.InnerText; break; } }

			// Material Lot ID
			foreach(System.Xml.XmlNode node in cNode.ChildNodes) { if(node.LocalName == "MaterialLotID") { materialLotID = node.InnerText; break; } }
		
			context.Instance.TraceInformation ("Source System ID: " + sourceSystemID);
			context.Instance.TraceInformation ("Plant ID: " + plantCodeID);
			context.Instance.TraceInformation ("Material ID: " + materialID);
			context.Instance.TraceInformation ("Material Lot ID: " + materialLotID);
			
			if (context.Properties["ReferencedLotSourceSystemID"].ToString() == sourceSystemID &amp;amp;&amp;amp;
				context.Properties["ReferencedLotPlantID"].ToString() == plantCodeID &amp;amp;&amp;amp;
				context.Properties["ReferencedLotMaterialID"].ToString() == materialID &amp;amp;&amp;amp;
				context.Properties["ReferencedLotMaterialLotID"].ToString() == materialLotID)
			{
				isMatch = true;
				context.Instance.TraceInformation ("We have a winner");
				additionalData = priorAdditionalData;
				break;
			}
			}
		}
		if (isMatch == false)
		{
			var doc1 = XDocument.Parse(moreAdditionalData);
			var doc2 = XDocument.Parse(priorAdditionalData).Element("ReferencedLots");
			context.Instance.TraceInformation (doc1.ToString());
			context.Instance.TraceInformation (doc2.ToString());
			
			doc2.Add(doc1.Nodes());
			
			additionalData = doc2.ToString();

			context.Instance.TraceInformation (additionalData);
			
		}
		
	}

	else
	{
		
	 	// Persisted Data is crapola, start a new document with the current data.
		additionalData = "&amp;lt;ReferencedLots&amp;gt;" + moreAdditionalData + "&amp;lt;/ReferencedLots&amp;gt;";
		context.Instance.TraceInformation ("Additional Data in the database is not of the expected structure; Starting a new collection");

		
	}
}
catch 
{

	//Persisted Data is crapola, start a new document with the current data.
	additionalData = "&amp;lt;ReferencedLots&amp;gt;" + moreAdditionalData + "&amp;lt;/ReferencedLots&amp;gt;";
	context.Instance.TraceInformation ("Additional Data in the database is not XML; Starting a new collection");
	
}

context.Instance.TraceInformation ("New Value of AdditionalData: " + additionalData);
additionalData = System.Net.WebUtility.HtmlEncode (additionalData);

// Create the request message
string mLAMRequest = string.Format(mLAMRequestTemplate, "Create/Update", context.Properties["LocalServiceURI"], 
	                        context.Properties["MaterialLotUID"], System.Guid.Empty.ToString(), 
	                        context.Properties["ReferencedLotFacilityUID"], additionalData);

//Send the trace message to document the request message.
context.Instance.TraceInformation ("Process Material Lot - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + mLAMRequest);
	
// Set message context to the request message 	
context.Data.Text = mLAMRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d59p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d59p1:string&gt;Neuron&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Neuron.Pipelines&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Neuron.Esb&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d59p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typef88d7fdd36e4049a24f8c7e795027c&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d58p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d58p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d59p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;efd2be78-1068-453a-99b0-49a8e469d282&lt;/Id&gt;&lt;Name&gt;Update ML Ancestor Map&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d58p1:FileName i:nil="true" /&gt;&lt;d58p1:MaxInstances&gt;100&lt;/d58p1:MaxInstances&gt;&lt;d58p1:PipelineName&gt;Process_CreateUpdateMaterialLotAncestors&lt;/d58p1:PipelineName&gt;&lt;d58p1:PoolTimeout&gt;PT1M&lt;/d58p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d58p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d58p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d59p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;1e917dc6-64a8-4ebb-a929-d312b9e499dd&lt;/Id&gt;&lt;Name&gt;Map From Update ML Ancestor&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d59p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string mLAMUID = context.Data.GetProperty ("NeoPLM", "MaterialLotAncestorMapUID");

context.Instance.TraceInformation ("Process Material Lot - Transaction ID: " + context.Properties["TransactionID"] + " Referenced MaterialLotAncestorMapUID: " + mLAMUID);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d59p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d59p1:string&gt;Neuron&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Neuron.Pipelines&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Neuron.Esb&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d59p1:string&gt;&lt;d59p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d59p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typee398f3014bb4f4d810d536b659c554&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Vendor Lot&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d47p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;c105c602-c2fe-4618-adf8-3ce183aca7d4&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d48p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d48p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d49p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;09dce70a-5cf3-49cd-8996-a863511f60f0&lt;/Id&gt;&lt;Name&gt;Map To Create Material Lot&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d49p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Retrieve the response template message
string materialLotRequestTemplate = context.Configuration.XmlDocs["MaterialLotSave"].Xml;

// This is a placeholder material Lot.  These properties are set to the default values below.
string externalStatus = context.Properties["StatusID"].ToString();
string externalStatusDescription = context.Properties["StatusDescription"].ToString();
string lotStatus = context.Properties["StatusUID"].ToString();
string potency = context.Properties["Potency"].ToString();
string potencyLabel = context.Properties["EngineeringUnitID"].ToString();
string potencyUnits = context.Properties["EngineeringUnitUID"].ToString();
string supplierID = context.Properties["SupplierID"].ToString();
string supplierName = System.Net.WebUtility.HtmlEncode (context.Properties["SupplierName"].ToString());
string supplierLotID = context.Properties["ReferencedLotMaterialLotID"].ToString();
string lastModified = System.DateTime.UtcNow.ToString("yyyy-MM-ddTHH:mm:ssZ").ToString();

System.DateTime dt = System.DateTime.Parse(context.Properties["LastUpdateDateTime"].ToString());

string sourceLastModified = dt.ToUniversalTime().ToString ("yyyy-MM-ddTHH:mm:ssZ");

// Create the request message
string materialLotRequest = string.Format(materialLotRequestTemplate, "Update", context.Properties["LocalServiceURI"], 
	                        context.Properties["MaterialLotID"], context.Properties["FacilityUID"], 
	                        context.Properties["PlantCodeUID"], context.Properties["MaterialMasterUID"], 
	                        context.Properties["NeoMaterialType"], externalStatus, externalStatusDescription, 
	                        lotStatus, potency, potencyLabel, potencyUnits, supplierID, supplierName, 
	                        supplierLotID, lastModified, sourceLastModified );

//Send the trace message to document the request message.
context.Instance.TraceInformation ("Process Material Lot - Message ID: " + context.Data.Header.MessageId.ToString() + " Request Message: " + materialLotRequest);
	
// Set message context to the request message 	
context.Data.Text = materialLotRequest;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d49p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d49p1:string&gt;Neuron&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Neuron.Pipelines&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Neuron.Esb&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d49p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type462126ea05c4d04b42064c3255e287&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d48p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d48p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d49p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;36e06b7d-df1f-49bf-bbf3-33cc3333232e&lt;/Id&gt;&lt;Name&gt;Update Material Lot&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d48p1:FileName i:nil="true" /&gt;&lt;d48p1:MaxInstances&gt;100&lt;/d48p1:MaxInstances&gt;&lt;d48p1:PipelineName&gt;Process_CreateUpdateMaterialLot&lt;/d48p1:PipelineName&gt;&lt;d48p1:PoolTimeout&gt;PT1M&lt;/d48p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d48p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d48p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d49p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;923a88a8-e2f7-46d3-8cf2-6f50caabb0c7&lt;/Id&gt;&lt;Name&gt;Map From Material Lot &lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d49p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;string materialLotUID = context.Data.GetProperty ("NeoPLM", "MaterialLotUID");

context.Properties ["MaterialLotUID"] = materialLotUID;

context.Instance.TraceInformation ("Process Operations Performance - Transaction ID: " + context.Properties["TransactionID"] + " MaterialLotUID: " + context.Properties["MaterialLotUID"]);&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d49p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d49p1:string&gt;Neuron&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Neuron.Pipelines&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Neuron.Esb&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d49p1:string&gt;&lt;d49p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d49p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type9b5f9b02d894592bae05ea79ecad56&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;CollectionPropertyName&gt;ReferencedLots&lt;/CollectionPropertyName&gt;&lt;ItemPropertyName&gt;ReferencedLot&lt;/ItemPropertyName&gt;&lt;TurnOffTrackExecution&gt;false&lt;/TurnOffTrackExecution&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d40p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;155998b9-aa3f-49c8-a727-8c92b0bcd8f0&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children /&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d35p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;3f16b8e8-372e-4e9c-8ed9-6b7f0e276171&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d36p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d36p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d37p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;b071258c-1a82-40f9-91f3-7f745c62385a&lt;/Id&gt;&lt;Name&gt;Internal Tracing - Transaction Material Master&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d37p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation ("The Material Lot Transaction Lccal Service URI could not be resolved.");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d37p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d37p1:string&gt;Neuron&lt;/d37p1:string&gt;&lt;d37p1:string&gt;Neuron.Pipelines&lt;/d37p1:string&gt;&lt;d37p1:string&gt;Neuron.Esb&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d37p1:string&gt;&lt;d37p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d37p1:string&gt;&lt;d37p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d37p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type8116962f77a4b0aaf7edfc5654be6c&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d30p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;0c8b8e66-2564-4a36-a355-c52ee1ee5233&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d31p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d31p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d32p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;395d3b1b-8a28-4fe7-aa99-8c7259a64a17&lt;/Id&gt;&lt;Name&gt;Internal Tracing - Transaction Material Master&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d32p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation ("The Material Lot Transaction Engineering Unit Label could not be resolved.");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d32p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d32p1:string&gt;Neuron&lt;/d32p1:string&gt;&lt;d32p1:string&gt;Neuron.Pipelines&lt;/d32p1:string&gt;&lt;d32p1:string&gt;Neuron.Esb&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d32p1:string&gt;&lt;d32p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d32p1:string&gt;&lt;d32p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d32p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type8116962f77a4b0aaf7edfc5654be6c&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d25p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;5c5bf183-ec27-4199-974e-b0f21c5782d7&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d26p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d26p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d27p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;d294e3b6-c331-4844-a0c3-08efeb74bab3&lt;/Id&gt;&lt;Name&gt;Internal Tracing - Transaction Material Master&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d27p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation ("The Goods Issue / Goods Receipt Transaction Material Lot Status could not be resolved.");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d27p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d27p1:string&gt;Neuron&lt;/d27p1:string&gt;&lt;d27p1:string&gt;Neuron.Pipelines&lt;/d27p1:string&gt;&lt;d27p1:string&gt;Neuron.Esb&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d27p1:string&gt;&lt;d27p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d27p1:string&gt;&lt;d27p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d27p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type8116962f77a4b0aaf7edfc5654be6c&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d20p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;38d88f4d-3b52-4f3b-b4d0-656d7d3a5c03&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d21p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d21p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d22p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;670987db-ea7d-4859-9474-40d362edc0b7&lt;/Id&gt;&lt;Name&gt;Internal Tracing - Transaction Material Master&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d22p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation ("The Material Lot Transaction Material Master could not be resolved.");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d22p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d22p1:string&gt;Neuron&lt;/d22p1:string&gt;&lt;d22p1:string&gt;Neuron.Pipelines&lt;/d22p1:string&gt;&lt;d22p1:string&gt;Neuron.Esb&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d22p1:string&gt;&lt;d22p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d22p1:string&gt;&lt;d22p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d22p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type8116962f77a4b0aaf7edfc5654be6c&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d15p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;7bdb3793-b21a-4e2f-a1c1-0c9c2aa108b5&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d16p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d16p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d17p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;6847e086-7664-4817-9264-41363f84afe6&lt;/Id&gt;&lt;Name&gt;Internal Tracing - External System UID&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d17p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;context.Instance.TraceInformation ("The Last Update Timestamp is not UTC Aware.");&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d17p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d17p1:string&gt;Neuron&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Neuron.Pipelines&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Neuron.Esb&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Newtonsoft.Json, Version=8.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d17p1:string&gt;&lt;d17p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d17p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Type8116962f77a4b0aaf7edfc5654be6c&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;BranchOfESBMessagexAPWb1W4&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Condition i:type="AlwaysBranchConditionOfESBMessagexAPWb1W4" /&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;EndJoined&gt;false&lt;/EndJoined&gt;&lt;Id&gt;ae6c82b4-4df1-4873-a055-8d8d401d599a&lt;/Id&gt;&lt;Name&gt;Else&lt;/Name&gt;&lt;Steps&gt;&lt;Bindings xmlns:d10p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;336a18c4-dd9c-4b99-975b-90739292567e&lt;/Id&gt;&lt;Name&gt;Group&lt;/Name&gt;&lt;Uniquename /&gt;&lt;Children&gt;&lt;ESBMessagePipelineStep xmlns:d11p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d11p1:EsbMessageCSharpCodePipelineStep"&gt;&lt;Bindings xmlns:d12p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;af37c0a8-0438-4dc5-83f6-7ab161e758fc&lt;/Id&gt;&lt;Name&gt;Create Potency Error&lt;/Name&gt;&lt;Uniquename /&gt;&lt;BreakPointLines xmlns:d12p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays" /&gt;&lt;Code&gt;// Get the data together to send the Business Error Message
string endpointAddress = "";
string eSBAction = "";
string eSBTopic = "ERP Material Lot Enrichment";
eSBTopic = eSBTopic.Replace("Enrich_", "") + "-Errors";
string sourceSystemID = context.Properties["SourceSystemID"].ToString();
string plantID = context.Properties["PlantID"].ToString();
string transactionID = context.Properties["TransactionID"].ToString();
string messageDate = "";
string errorCode = "1095";
string errorMessage = "Material Lot rejected due to Invalid Potency value.";
string errorParameter = "Potency Value: " + context.Properties["Potency"].ToString();

string originalMessage = System.Net.WebUtility.HtmlEncode(context.Data.GetProperty("NeoPLM", "OriginalMessage"));

// Get the business error template
string errorTemplate = context.Configuration.XmlDocs["ESB Business Error Message"].Xml;

string eSBErrorMessage = string.Format(errorTemplate, endpointAddress, eSBAction, eSBTopic, sourceSystemID, plantID, transactionID, messageDate, errorCode, errorMessage, originalMessage);

//Set Values for Error Properties
context.Properties["ErrorMessage"] = eSBErrorMessage;
context.Properties["ErrorTypeID"] = errorCode;
context.Properties["ErrorParameter"] = errorParameter;

context.Instance.TraceInformation(" ERROR MESSAGE HERE  : " + context.Properties["ErrorMessage"].ToString());

context.Data.Text = eSBErrorMessage;&lt;/Code&gt;&lt;ReferencedAssemblies xmlns:d12p1="http://schemas.microsoft.com/2003/10/Serialization/Arrays"&gt;&lt;d12p1:string&gt;Neuron&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Neuron.Pipelines&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Neuron.Esb&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Core, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Xml, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Xml.Linq, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Data.DataSetExtensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.Runtime.Serialization, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;System.ServiceModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Newtonsoft.Json, Version=12.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed&lt;/d12p1:string&gt;&lt;d12p1:string&gt;Microsoft.CSharp, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&lt;/d12p1:string&gt;&lt;/ReferencedAssemblies&gt;&lt;TypeName&gt;Typef7cb1d004a04d44a06a7689c22d65b&lt;/TypeName&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d11p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d11p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d12p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;780f91d7-a2bf-4ab5-8a06-ac4235df662b&lt;/Id&gt;&lt;Name&gt;ODBC Logging&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d11p1:FileName i:nil="true" /&gt;&lt;d11p1:MaxInstances&gt;100&lt;/d11p1:MaxInstances&gt;&lt;d11p1:PipelineName&gt;ODBC Business Error Publisher&lt;/d11p1:PipelineName&gt;&lt;d11p1:PoolTimeout&gt;PT1M&lt;/d11p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;ESBMessagePipelineStep xmlns:d11p1="http://schemas.neuronesb.com/pipelines/esb/" i:type="d11p1:EsbMessagePipelineExecutionPipelineStep"&gt;&lt;Bindings xmlns:d12p1="http://schemas.datacontract.org/2004/07/Neuron.ComponentModel" /&gt;&lt;BreakPoint&gt;Disable&lt;/BreakPoint&gt;&lt;Disable&gt;false&lt;/Disable&gt;&lt;Id&gt;c3981e2b-7519-4b21-802b-e9191318d599&lt;/Id&gt;&lt;Name&gt;Set Workflow Error Properties&lt;/Name&gt;&lt;Uniquename /&gt;&lt;d11p1:FileName i:nil="true" /&gt;&lt;d11p1:MaxInstances&gt;100&lt;/d11p1:MaxInstances&gt;&lt;d11p1:PipelineName&gt;SetWorkflowErrorProperties&lt;/d11p1:PipelineName&gt;&lt;d11p1:PoolTimeout&gt;PT1M&lt;/d11p1:PoolTimeout&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Steps&gt;&lt;/BranchOfESBMessagexAPWb1W4&gt;&lt;/Branches&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Children&gt;&lt;/Try&gt;&lt;/ESBMessagePipelineStep&gt;&lt;/Steps&gt;&lt;/ESBMessagePipeline&gt;</PipelineBlob>
  <IsProcessFlow>false</IsProcessFlow>
</ESBMessagePipelineStorage>